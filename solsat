#!/usr/bin/env python3
from slither.slither import Slither
from patterns.detectStructPacking import detect_struct_packing
from patterns.detectStateVariablePacking import detect_state_variable_packing

def analyze_contract(file_path):
    """
    Runs all gas inefficiency checks on a Solidity file.
    """
    slither = Slither(file_path)

    analysis_results = []
    print("Running gas optimization checks...")

    analysis_results.extend(detect_struct_packing(slither))
    analysis_results.extend(detect_state_variable_packing(slither))


    return analysis_results


def generate_report(results, output_file="report.json"):
    """
    Generates a JSON report of the analysis results.
    """
    import json
    with open(output_file, 'w') as f:
        json.dump(results, f, indent=4)
    print(f"Report saved to {output_file}")


if __name__ == "__main__":
    import argparse

    parser = argparse.ArgumentParser(description="Static Analysis Tool for Gas Optimization in Solidity Smart Contracts")
    parser.add_argument("file", help="Path to the Solidity file")
    parser.add_argument("--output", default="report.json", help="Output file for the report")

    args = parser.parse_args()

    results = analyze_contract(args.file)
    generate_report(results, args.output)
